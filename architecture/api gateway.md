# API Gateway (1차)

### 개념와 역할
- 개념
    - API서버 앞단에서 모든 API서버들의 엔드포인트를 단일화해주는 또 다른 서버
- 동작
    - 엔드포인트 앞에서 수신되는 api 호출을 가로채고, 보안 정책을 실행한 후 호출을 라우팅하여 백앤드 애플리케이션으로 호출을 라우팅
    - 요청을 처리한 후 백엔드 애플리케이션이 게이트웨이에 응답을 보내면 호출자에게 다시 응랍을 라우팅
- MSA에서 언급되는 컴포넌트중 하나
- 인증 및 권한, 모니터링, 로깅


### 필요성
- MSA는 큰 서비스를 작은 서비스로 쪼개어 개발/운영하는 아키텍처
- 각각의 서비스마다 인증/인가 로직을 구현해야함
- 수많은 api 호출을 모니터링 하기 어려움
- 클라이언트에서 여러 마이크로 서비스에 대한 번거로운 호출을 해야함
- 내부 비지니스 로직이 드러나 보안에 취약? (왜드러나..?)
-> 시스템 내부에 아키텍처를 숨길 수 있어 좋다..? (일단 넘기자)

### 특징
- ESB(Enterprise Service Bus)에서 많은 부분들이 승계됨
- ESB
    - SOAP/XML 기반, 무거움
- API Gateway
    - REST/JSON 기반, 가벼움


### 주요 기능
- 공통 작업 수행
    - 인증서 관리, 인증 및 인가, SSL, 프로토콜 변환과 같은 기능은 API Gateway에서 처리함으로서 각각 서비스의 부담 및 중복을 줄이고 관리를 용이하게 함
- 요청 절차의 단순화
    - 여러 클라이언트의 요청을 단일 클라이언트의 요청으로 대체 가능하도록 함으로서 클라이언트와 백앤드간의 api 통신량 및 대기시간을 감소시킨다. 통신량을 줄여? 설계만 잘하면 절대적인 양은 똑같지 않나 (다시보기)
    -> 여러 마이크로 서비스와 상호 작용하여 단일 UI 화면을 빌드하면 인터넷에서 왕복 수가 증가합니다. 해당 접근 방식을 사용하면 대기 시간 및 UI 쪽 복잡성이 증가하는 경우
    - 마이크로서비스가 추가되거나 변경 될 경우 클라이언트에서 가지고있는 정보를 수정해야하는 상황을 방지
- 라우팅 및 로드밸런싱
    - api 호출을 적절한 서비스에 라우팅함으로서 서비스들에 가해지는 부하 분산
    - 클라이언트 요청에서 어떤 서비스에서 보내는 것인지를 명시해줄 필요가 없음
- 서비스 오케스트레이션 or 어그레이션
    - 오케스트레이션
        - 여러 API 새로운 서비스를 만드는 개념
- 서비스 디스커버리
    - 각 서비스를 호출하기 위해 알고있어야하는 ip주소와 포트번호를 찾는 행위 (동적인 클라우드 환경에서 효과적)

### 적용 시 고려사항
- Scale-out 적용이 유연하게 일어나지 않을 경우, API Gateway가 병목지점이 되어 어플리케이션의 성능 저하 발생
- API Gateway라는 추가적인 계층이 발생하는 것이기 때문에, 그만큼 네트워크 레이턴시가 증가


### 참고
- https://techblog.woowahan.com/2523/
- https://tommypagy.tistory.com/143
- https://bcho.tistory.com/1005
- https://docs.microsoft.com/ko-kr/dotnet/architecture/microservices/architect-microservice-container-applications/direct-client-to-microservice-communication-versus-the-api-gateway-pattern